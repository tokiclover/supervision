#!/bin/sh
#
# $Header:  /etc/sv/.opt/cmd                             Exp $
# $License: 2-clause/new/simplified BSD                  Exp $
#

#
# ZSH compatibility
#
if [ -n "${ZSH_VERSION}" ]; then
	emulate sh
	NULLCMD=:
	setopt NO_GLOB_SUBST NULLGLOB SH_WORD_SPLIT
	disable -r end
elif [ -n "${BASH_VERSION}" ]; then
	shopt -qs nullglob
else
	case "$(set -o 2>/dev/null)" in
		(*posix*) set -o posix;;
	esac
fi

exec 2>&1

case "${0}" in
	(/*) head="${0%/*}"   ;;
	(*)  head="${PWD}/${0#./}"
	     head="${head%/*}";;
esac
:	${SVC_DIR=${head%/log}}
:	${SVC_NAME=${SVC_DIR##*/}}
case "${SVC_DIR}" in
	(*/run/*|*/tmp/*)
:	${SV_RUNDIR=${SVC_DIR%/*}}
	;;
	(*)
:	${SV_SVCDIR=${SVC_DIR%/*}}
	;;
esac

case "${head}" in
	(*/log) __cmd_dir__=log;;
	(*)     __cmd_dir__="" ;;
esac
unset head
__cmd__="${0##*/}"
RS_TYPE=sv

source "${SVC_DIR}"/../.opt/SVC_OPTIONS ||
	{ echo "Required file not found." >&2; exit 1; }
#
# Handle [log/]{finish,run} & exec to the command
#
eval svc${__cmd_dir__:+_${__cmd_dir__}}_${__cmd__} "${@}"

#
# vim:fenc=utf-8:ft=sh:ci:pi:sts=0:sw=4:ts=4:
#
