#
# $Header:  /etc/sv/udev/OPTIONS                         Exp $
# $License: 2-clause/new/simplified BSD                  Exp $
#

SVC_CMD=/sbin/udevd
SVC_OPTS=
SVC_BEFORE='checkfs'
SVC_NEED='devfs sysfs'
UDEV_DEBUG=No

pre()
{
	if ! grep -q devtmpfs /proc/filesystems; then
		if yesno "${USE_MDEV:-YES}"; then
			begin "Starting mdev\n"
			${RS_SVCDIR}/mdev start
			end "${?}"
		fi
		error "DevtmpFS is not supported"
		return 1
	fi
	if ! mountinfo -q /dev; then
		mount -t devtmpfs -o nosuid,mode=755,size=${DEV_FS_SIZE:-10M} \
			dev /dev >${NULL} 2>&1 ||
			{ error "Failed to setup devtmpfs"; return 2; }
		mkdir -p /dev/pts /dev/shm
	fi
	if [ ! -e /proc/net/unix ]; then
		if ! modprobe unix; then
			error "Failed to load unix domain socket module"
			return 3
		fi
	fi
	if [ -e /proc/sys/kernel/hotplug ]; then
		echo '' >/proc/sys/kernel/hotplug
	fi
	if yesno "${UDEV_DEBUG}"; then
		CMD_OPTS="${CMD_OPTS} --debug 2> /run/udevdebug.log"
	else
		return 0
	fi
}

#
# vim:fenc=utf-8:ft=sv:ci:pi:sts=0:sw=4:ts=4:
#
